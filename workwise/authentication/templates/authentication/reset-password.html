{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="{% static 'css/vendors.css' %}">
    <link media="all" rel="stylesheet" href="{% static 'css/jobplugin.css' %}">
    <link media="all" rel="stylesheet" href="{% static 'css/theme-color.css' %}">
  <title>Reset Password</title>
  <style>
    .jobplugin__userbox input,
    .jobplugin__userbox select {
      width:100%; margin:10px 0; padding:10px;
      border:1px solid #ddd; border-radius:6px;
    }
  </style>
</head>
<body class="jobplugin">
  <div class="jobplugin__wrapper">
    {% include "includes/header.html" %}
    <main class="jobplugin__main">
      <div class="jobplugin__container">
        <div class="jobplugin__userbox">
          <span class="jobplugin__userbox-bar jobplugin__bg-primary"></span>
          <h2 class="jobplugin__text-secondary h3">Reset Password</h2>

          <form id="reset-form" method="post" action="{% url 'auth:reset_password' %}">
            {% csrf_token %}

            {% if errors %}
              <div class="jobplugin__form-errors">
                <ul>
                  {% for err in errors %}
                    <li style="color:red;">{{ err }}</li>
                  {% endfor %}
                </ul>
              </div>
            {% endif %}

            <p id="clientError" style="color:red; font-size:small; margin-bottom:10px;"></p>

            <input type="email" name="email" placeholder="Email Address"
                   value="{{ form_data.email }}">
            <select name="account_type">
              <option value="">Select account type</option>
              <option value="candidate" {% if form_data.account_type == 'candidate' %}selected{% endif %}>
                Candidate
              </option>
              <option value="employer" {% if form_data.account_type == 'employer' %}selected{% endif %}>
                Employer
              </option>
            </select>

            <div class="jobplugin__userbox-button">
              <button type="submit" name="send_otp" id="sendOtpBtn"
                      class="jobplugin__button jobplugin__bg-primary" disabled
                      style="opacity:0.5;">
                Send OTP
              </button>
            </div>
          </form>
        </div>
      </div>
    </main>
    {% include "includes/footer.html" %}
  </div>

  <!-- jQuery Library -->
<script src="{% static 'js/jquery-3.6.4.min.js' %}"></script>
<!-- jQuery Plugins File -->
<script src="{% static 'js/vendor.js' %}"></script>
<!-- jQuery Functions JS File -->
<script src="{% static 'js/jquery.main.js' %}"></script>

  <script>
  (function(){
    const form     = document.getElementById('reset-form');
    const emailEl  = form.querySelector("input[name='email']");
    const typeEl   = form.querySelector("select[name='account_type']");
    const sendBtn  = document.getElementById('sendOtpBtn');
    const errP     = document.getElementById('clientError');
    const emailRe  = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    let touched = { email:false, account_type:false };

    function validatePhase1(){
      let msgs = [];
      if (touched.email && !emailRe.test(emailEl.value.trim()))
        msgs.push('enter a valid email address');
      if (touched.account_type && !['candidate','employer'].includes(typeEl.value))
        msgs.push('please select account type');

      errP.textContent = msgs[0] || '';

      const ok = emailRe.test(emailEl.value.trim())
              && ['candidate','employer'].includes(typeEl.value);

      sendBtn.disabled = !ok;
      sendBtn.style.opacity = ok ? '1':'0.5';
    }

    emailEl.addEventListener('blur', ()=>{ touched.email=true; validatePhase1(); });
    emailEl.addEventListener('input', ()=> touched.email&&validatePhase1());
    typeEl.addEventListener('change', ()=>{ touched.account_type=true; validatePhase1(); });

    // initial
    validatePhase1();
  })();
  </script>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const errBox = document.querySelector('.jobplugin__form-errors');
    if (errBox) {
      setTimeout(() => {
        errBox.style.display = 'none';
      }, 10000);
    }
  });
</script>


</body>
</html>
